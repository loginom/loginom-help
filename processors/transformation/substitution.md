# ![Замена](../../media/app/icons/vendors/replacecolumns.svg) Замена

## Описание

Обработчик заменяет данные исходного набора, используя таблицы замен. Таблицы замен содержат пары заменяемых и новых значений или вычисляющие их регулярные выражения. Эти таблицы можно задать вручную в мастере настройки (внутренние) или подать на вход обработчика (внешние).

Последовательность действий алгоритма замены:

 1. Вначале производится поиск и замена по [точному совпадению](./substitution/exact-match.md) со значениями, указанными в таблице замен.
 2. Среди значений, не найденных по точному совпадению, производится поиск по [регулярным выражениям](./substitution/regexp-match.md). Такие выражения могут быть заданы во внутренних таблицах замен. Новые значения также вычисляются регулярными выражениями.
 3. Выполняются правила замены для значений, не найденных на предыдущих шагах.

### Вход

* ![Входной источник данных](../../media/app/icons/ports/table-inactive.svg) **Входной источник данных** (таблица данных) — набор данных, подлежащий изменению.
* ![Набор данных](../../media/app/icons/ports/table-inactive.svg) **Присоединяемая таблица [N]** (таблица данных) — набор данных, содержащий таблицу замен.
* ![Добавление порта](../../media/app/icons/toolbar-18/add-inactive.svg) **Добавление еще одного порта.** Поскольку таблиц замен может быть несколько, то необходимые порты для них могут быть добавлены пользователем.

### Выход

* ![Выходной набор данных](../../media/app/icons/ports/table-inactive.svg) **Выходной набор данных** (таблица данных). При настройке соответствия между столбцами порта можно выбрать варианты замены или добавления столбцов.

## Мастер настройки

Окно мастера настройки состоит из 3-х областей:

 1. [**Способы замен**](#sposoby-zamen);
 2. [**Таблица замен**](#tablitsa-zamen);
 3. [**Дополнительные параметры**](#dopolnitelnye-parametry).

### Способы замен

Для каждого поля исходного набора задается способ замены:

* **Не заменять** — выходной набор данных замены производиться не будут;
* **Ввод вручную** — используется внутренняя таблица замен;
* **Таблица замен** (Таблица замен N) — используется внешняя таблица замен. Данный способ присутствует в настройках, если на входной порт обработчика подаются данные внешней таблицы замен. **Таблица замен N** — наименование принимающего таблицу порта.

### Таблица замен

Отображает внешнюю или внутреннюю таблицу замен для выбранного поля исходного набора.

#### Настройка внутренней таблицы

Для ввода новой строки в таблице замены используется кнопка ![Добавление строки](../../media/app/icons/toolbar-18/toolbar-18-27.svg). Таблица может содержать строки для поиска и замены по:

* [**Точному совпадению**](./substitution/exact-match.md);
* [**Регулярному выражению**](./substitution/regexp-match.md) (применимо только к данным строкового типа).

При вводе вручную таблицы замены доступны ряд действий через панель инструментов области:

* ![Импорт](../../media/app/icons/toolbar-18/toolbar-18-137.svg) **Импорт** — импорт таблицы замен из текстового файла;
* ![Экспорт](../../media/app/icons/toolbar-18/toolbar-18-41.svg) **Экспорт** — экспорт таблицы замен в текстовый файл;
* ![Сортировка](../../media/app/icons/toolbar-18/toolbar-18-116.svg) **Сортировка** — сортировка таблицы по полю исходного значения;
* **Изменить тип замены** — задает тип данных столбца с новыми значениями;
* ![Редактировать текущую замену](../../media/app/icons/toolbar-18/toolbar-18-28.svg) **Редактировать текущую замену** — отображает область редактирования текущей строки таблицы подстановок.

#### Настройка внешней таблицы

Для полей таблицы необходимо выбрать **Назначение** из следующих вариантов:

* ![Не используется](../../media/app/processors/substitution-04.svg) **Не используемое** — поле таблицы замен не будет использоваться;
* ![Значение](../../media/app/processors/substitution-09.svg) **Значение** — поле содержит заменяемые значения;
* ![Замена](../../media/app/processors/substitution-08.svg) **Замена** — поле содержит новые значения;
* ![Информационное](../../media/app/processors/substitution-03.svg) **Информационное** — поле содержит дополнительный вариант нового значения. Дополнительные варианты замены выводятся в результирующем наборе данных отдельным столбцом.

--------

>**Важно:**
>1. Замена по точному совпадению имеет приоритет перед заменой по регулярному выражению.
>2. Если замена одного значения может быть произведена по условиям нескольких строк таблицы замен, то приоритет имеет первая из них. В связи с этим **сортировка таблицы замен может влиять на результат обработки**. Данное правило не применяется при использовании [допустимого интервала](./substitution/exact-match.md) (см. параметр "Точность").

### Дополнительные параметры

* **Заменять остальные** — содержит варианты замены значений, не найденных при помощи таблицы замен:
  * **Не заменять** — замены производиться не будут;
  * **На пропущенное** — значения будут заменены на Null;
  * **На значение** — значения будут заменены на указанное;
  * **На регулярное выражение** — новое значение будет вычислено с использованием [синтаксиса регулярного выражения](./substitution/syntax-regexp.md).
* **Точность** — для полей целого и вещественного типов задает допустимый интервал от указанных в таблицах замен значений, при котором исходное значение будет заменено. См. [применение допустимого интервала](./substitution/exact-match.md).
* **Регистрозависимые строки** — флаг устанавливает регистрозависимый режим поиска значений в таблицах замен. По умолчанию данный режим не используется.
