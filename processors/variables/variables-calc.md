# ![ ](../../images/icons/vendors/calcvariables.svg) Калькулятор (переменные)

## Описание

Обработчик предназначен для математических операций над переменными. В мастере настройки создаются новые переменные и вычисляются их значения в соответствии с выражениями, заданными пользователем.

## Порты

### Вход

* ![](../../images/icons/ports/optional_input_variable_inactive.svg) Входные переменные.

### Выход

* ![](../../images/icons/ports/output_variable_inactive.svg) Выходные переменные — входные переменные и новые переменные, вычисленные обработчиком.

## Мастер настройки

Окно настроек содержит области:

 1. [Список выражений](#spisok-vyrazheniy)
 2. [Область кода выражения](#oblast-koda-vyrazheniya)
 3. [Переменные](#peremennye)
 4. [Список функций](#spisok-funktsiy)

### Список выражений

Область предназначена для ввода *выражений — вычисляемых переменных, которыми в результате обработки будет дополнен выходной набор данных*. Значение выражения в каждой строке набора данных будет вычислено по формуле, заданной в области кода выражения.

Новое выражение можно создать при помощи панели инструментов области или контекстного меню. Операции панели инструментов и контекстного меню:

* ![](../../images/icons/.svg) Редактировать — задание параметров выражения;
* ![](../../images/icons/.svg) Переместить вверх — поднять выражение на одну позицию вверх по списку;
* ![](../../images/icons/.svg) Переместить вниз — опустить выражение на одну позицию вниз по списку;
* ![](../../images/icons/.svg) Добавить выражение — добавляет новое выражение с параметрами по умолчанию;
* ![](../../images/icons/.svg) Добавить выражение по образцу — добавляет новое выражение с типом данных, описанием и формулой, как у текущего выражения;
* ![](../../images/icons/.svg) Удалить выражение — удаляет текущее выражение;
* ![](../../images/icons/.svg) Удалить все выражения — удаляет все имеющиеся выражения.

При добавлении и редактировании выражения отображается диалог редактирования параметров. Следующие параметры выражений доступны для изменений:

* Имя — имя переменной в выходном наборе данных. Имя должно быть уникальным, начинаться с заглавной или строчной латинской буквы или с символа подчеркивания. Последующие символы имени могут быть такими же, либо цифрами;
* Метка — метка переменной в выходном наборе данных.
* Тип данных — [тип данных](../../data/datatype.md) переменной в выходном наборе данных.
* Промежуточное — при установке этого флага выражение может использоваться в расчетах, но не включается в список переменных выходного набора данных.
* Описание — поясняющая информация.

При первом открытии мастера настройки список выражений содержит один элемент с именем "Expr0" вещественного типа. По умолчанию для нового выражения назначается метка ВыражениеN и имя ExprN, где N — номер, обеспечивающий уникальность.

После настройки параметров выражения в область кода требуется ввести рассчитываемую формулу.

### Область кода выражения

В области кода задается формула расчета выражения. Ссылки на переменные и синтаксические конструкции функций можно вставлять в код выражения, выбрав их двойным кликом мыши в соответствующих областях или перетащив мышкой.

Изменения в области кода сохраняются при выходе из нее.

Формула выражения может содержать:

* ссылки на другие переменные набора данных в виде наименования переменных или ранее вычисленных выражений;
* ссылки на переменные входного порта;
* скобки, определяющие порядок выполнения операций;
* знаки математических операций и отношений;
* логические операции (and, or, not, xor) и значения (true или 1, false или 0);
* функции в соответствии с синтаксическим описанием (см. далее "[Список функций](#spisok-funktsiy)");
* строковые выражения в кавычках ("строковое выражение");
* целые и вещественные числа;
* однострочные и многострочные комментарии.

Однострочный комментарий начинается символами // (два слеша) и продолжается до конца строки. Многострочным комментарием считаются все символы, содержащиеся между /* (слеш-звездочка) и */ (звездочка-слеш).

Пример комментария:

```java
// Пример однострочного комментария.

IF(IsNull(var_one),var_two,var_one) // однострочный комментарий продолжается до конца строки

/* Многострочным комментарием
считаются все символы,
содержащиеся между (слеш-звездочка)
 и (звездочка-слеш). */
```

### Переменные

Область содержит список переменных, передаваемых на вход обработчика. Перечень и параметры переменных определяются при настройке входных портов обработчика.

Двойной клик мыши по позиции списка вводит имя переменной в область кода выражения. То же самое можно сделать при помощи Drag-and-drop.

### Список функций

Наименование, входные аргументы и описание [доступных для использования функций](../func/calc-func/README.md).

Возможна фильтрация по категории и названию функции.

Двойной клик мыши по позиции выбранной функции вставляет ее синтаксис в область кода выражения. То же самое можно сделать при помощи Drag-and-drop.

------

**Примечание:**

Расчет значений выражений осуществляется в том порядке, в котором они следуют в списке выражений, т.е. сначала вычисляются выражения, находящиеся выше в списке. В формуле выражения возможно использовать только выражения, находящиеся выше по списку. В связи с этим неверная позиция в списке может приводить к ошибке.

Обработчик "Калькулятор" использует механизм ленивых вычислений[^1], это означает, что расчет производится только тогда, когда значение выражения отображается или используется другим узлом сценария.

[^1]: **Ленивые вычисления** – применяемая в программировании стратегия вычисления, согласно которой вычисления следует откладывать до тех пор, пока не понадобится их результат. Отложенные вычисления позволяют сократить общий объём вычислений за счёт тех вычислений, результаты которых не будут использованы.
