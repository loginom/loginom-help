# Автоматический подбор параметров Нейросети

Автоматический подбор параметров Нейросети позволяет подобрать оптимальную структуру сети автоматически.

Нейросеть имеет три подбираемых параметра, относящихся к структуре:

* Количество скрытых слоев (0, 1 или 2);
* Количество нейронов в каждом из скрытых слоев;
* Степень регуляризации — параметр, регулирующий жесткость модели.

Все эти параметры совместно определяют эффективное число степеней свободы модели.

## Мастер настройки

Настроить автоматический подбор параметров Нейросети можно на соответствующих страницах мастеров [Нейросеть (классификация)](./neural-network-classification.md) и [Нейросеть (регрессия)](./neural-network-regression.md).

### Настройка автоматического подбора параметров Нейросети

#### Общие параметры

* **Подобрать структуру** — автоматический подбор структуры Нейросети:
  * **Начать с указанной структуры** — использование в качестве начальных параметров значений, заданных на странице настройки параметров Нейросети.
* **Подобрать степень регуляризации** — автоматический подбор степени регуляризации Нейросети:
  * **Начать с указанной степени регуляризации** — использование в качестве начальных параметров значений, заданных на странице настройки параметров Нейросети.

> **Примечание:** если необходимо осуществлять подбор параметров для больших входных объемов или сложных моделей, можно включить только подбор структуры либо только степени регуляризации, сократив время на обучение.

#### Параметры выборки

* **Использовать подмножество обучающего набора** — выбор размера подмножества для автоподбора;
* **Размер выборки в процентах** — размер подмножества обучающей выборки;
* **Максимальный размер выборки** — максимальный размер подмножества обучающей выборки.

#### Критерии останова автоподбора

По умолчанию процесс автоматического подбора останавливается при невозможности найти лучшие параметры, чем уже найденные. Для ограничения времени работы предусмотрена возможность ограничить, в том числе одновременно: количество шагов автоподбора и время автоподбора.

* **Шагов автоподбора не более** — максимальное количество шагов алгоритма (0 — отключение ограничения);
* **Время автоподбора не более (сек.)** — максимальное время работы алгоритма (0 — отключение ограничения).

>**Примечание:** при работе следует учитывать, что фактически оба ограничения могут быть незначительно превышены при использовании подвыборки для автоподбора, так как последним этапом, который не учитывается ограничениями, будет осуществлено обучение лучшей Нейросети на полном наборе.

Отдельный случай останова оптимизатора — если достигнут теоретически наилучший результат. Как для регрессионных сетей, так и для классификатора это равная 0 среднеквадратическая ошибка на обучающем множестве.

Для классификатора также по умолчанию включен *Останов при нулевой ошибки классификации*:

* **Останов при нулевой ошибки классификации** — прекращение автоподбора при достижении нулевой ошибки классификации.

>**Примечание:** опцию *Останов при нулевой ошибки классификации* можно отключить,
т.к. правильная классификация всех примеров не всегда означает наилучшую структуру Нейросети: оптимизатору можно дать возможность подобрать сеть с лучшей обобщающей способностью (например, с меньшим числом нейронов или сильнее регуляризованную), но при этом не обязательно с нулевой ошибкой классификации.

## Стратегия оптимизации

Целевой функцией для оптимизатора является среднеквадратическая ошибка на обучающем наборе. При этом для учета случаев, когда несколько сетей показывают сравнимые по точности результаты, в целях выбора сети с самой простой структурой значение целевой функции дополнительно штрафуется на слабо отличающийся от единицы множитель (1+1e-8) за каждый скрытый нейрон.

Стратегия оптимизации следующая:

* Если необходимо подобрать только степень регуляризации для заданной структуры:
  1. Если начальная точка не задана, то степень регуляризации подбирается методом "золотого сечения", в противном случае - методом "схождения к вершине".
* Если необходимо подобрать только структуру, не изменяя степень регуляризации
  1. Если не задана начальная структура, то она подбирается в два этапа: сначала происходит выбор количества скрытых слоев (0, 1 или 2), затем, если результат предыдущего этапа не 0, грубо подбирается размер скрытых слоев методом "золотого сечения", причем для 2 скрытых слоев количество нейронов на данном этапе делается одинаковым;
  2. Структура подбирается сразу по всем трем параметрам (число слоев, число нейронов) методом "схождения к вершине" из заданной либо подобранной начальной точки.
* Если необходим автоподбор структуры и регуляризации:
  1. Подбирается структура так же, как и в предыдущем пункте. При этом, если начальное значение регуляризации задано, то используется оно, в противном случае регуляризация отключена.
  2. Если начальное значение регуляризации не было задано, оно подбирается методом "золотого сечения".
  3. Финальный этап автоподбора производится методом "схождения к вершине" по всем четырем параметрам.

Блок-схема (граф переходов) реализованной стратегии автоподбора указана на рисунке ниже.
