# ![](../../images/icons/vendors/wsdlclient.svg) Вызов веб-сервиса

Компонент позволяет взаимодействовать с внешним [SOAP-сервисом](https://ru.wikipedia.org/wiki/SOAP), отправляя ему запросы и получая ответы. SOAP-сервису может быть отправлено несколько последовательных запросов, формируемых из строк входной таблицы с параметрами запросов. На выходных портах обработчика формируются таблицы с ответами сервиса, возвращенными ошибками и дополнительными данными. XML ответов сервиса преобразуются в табличное представление.

Для работы с веб-сервисом необходимо настроенное [подключение к веб-сервису](../../integration/connections/list/web-service.md).

## Порты

### Входные порты

* ![](../../images/icons/ports/input_connection_inactive.svg) — Подключение к веб-сервису (связь с компонентом *Подключение  веб-сервиса*).
* ![](../../images/icons/ports/output_table_inactive.svg) — Источник данных запроса (таблица с параметрами запроса).
* ![](../../images/icons/ports/optional_input_variable_inactive.svg) — Управляющие переменные (переменные), необязательный.

### Выходные порты

* ![](../../images/icons/ports/output_table_inactive.svg) — Выходной набор данных (таблица с ответами веб-сервиса).
* ![](../../images/icons/ports/output_table_inactive.svg) — Исключения (WSDL fault).
* ![](../../images/icons/ports/output_table_inactive.svg) — Дополнительные данные (таблица) содержат описание ошибок и SOAP-ответы сервиса.

## Настройка

Мастер настройки вызова сервиса состоит из нескольких шагов.

### Выбор метода запроса

Необходимо выбрать один из доступных методов запроса, предоставляемых веб-сервисом. В верхней части окна расположено поле *Подключение* отображающее состояние подключения:

* Если подключение не активно, то запись *Подключение к веб-сервису* окрашена серым, и справа от поля становится активна кнопка *Подключить*, после подключения к сервису кнопка становится серой и меняет надпись на *Подключено*.
* Если к порту *Подключение к веб-сервису* не установлена связь с подключением *Веб-сервис*, то поле *Подключение* будет неактивно и иметь запись *Локальное*, а кнопка значение *Не подключено*. В данном случае дальнейшая настройка узла невозможна.

В нижней части окна расположена таблица, она становится активной после подключения к сервису. Таблица состоит из трех столбцов:

* Первый столбец не имеет названия. В нем расположены радиокнопки для выбора используемого метода;
* **Объект** — отображает дерево запросов полученное от подключения к веб-сервису;
* **Описание** — описание метода полученное от подключения к веб-сервису.

### Настройка запроса

На данном шаге задаются параметры запроса. Слева расположен список значений параметров, который берется из полей входного набора данных. Справа расположена таблица, где представлен выбранный метод с отображением его иерархической структуры. Для дальнейшей настройки необходимо проставить связи между полями и параметрами сделать это можно несколькими способами:

* **Методом Drag-and-drop** — перетащить метку поля на элемент метода;
* В правой таблице выбрать нужный элемент метода, и в столбце *Связанные поля* нажав на ячейку столбца выбрать из выпадающего списка метку поля из входного набора;
* Нажать на ![](../../images/icons/toolbar-controls_18x18/toolbar-controls_18x18_auto-connect_default.svg) *Связать все автоматически*, в таком случае происходит автоматическая связка метки с элементом метода. Связка происходит на соотношении меток и типов данных полей входного набора и метода.

> **Примечание**: Если связь между полем и объектом была установлена неправильно, ее можно удалить, нужно выбрать метку и нажать на кнопку ![](../../media/app/icons/toolbar-18/toolbar-delete-join.svg) на линии связи. При необходимости удаления всех связей используется кнопка ![](../../images/icons/toolbar-controls_18x18/toolbar-controls_18x18_remove-all-links_default.svg) *Удалить все связи*.

* **Наличие временной зоны** — определяет указывается ли информация о [часовом поясе](https://ru.wikipedia.org/wiki/Список_часовых_поясов_по_странам) в рамках стандарта [ISO_8601](https://ru.wikipedia.org/wiki/ISO_8601) при передачи параметров запроса типа `Дата/Время`. Возможные значения:
  
  * Не указывать.
  * Не указывать для даты — не указывать временную зону для элементов SOAP-запроса типа [Date](https://www.w3.org/TR/xmlschema-2/#date).
  * Указывать всегда.

### Настройка ответа сервиса

Необходимо выбрать параметры ответа веб-сервиса, которые будут включены в результирующую таблицу в виде отдельных столбцов.

### Настройка обрабатываемых исключений

На данном шаге выбираются атрибуты ошибок, которые необходимо вывести в выходном наборе порта *Исключения*.

### Настройка пользовательских заголовков

На данном шаге задаются имена и значения [заголовков HTTP-запросов](https://ru.wikipedia.org/wiki/HTTP#Заголовки) к сервису.

### Дополнительные параметры

* Идентификация запроса.
  * **Один запрос в каждой строке входного запроса** — каждая строка таблицы содержит параметры одного запроса к сервису.
  * **Идентификатор запроса — поле входного набора** — каждый запрос формируется из нескольких строк таблицы с совпадающим идентификатором. Необходимо выбрать поле идентификатора из списка полей входного набора.
* Обработка ответа.
  * **Временная зона по умолчанию** — если в параметре ответа типа дата/время указана временная зона, то его значение преобразуется. В случае если *Временная зона по умолчанию* задана пользователем, то происходит преобразование к ней. В противном случае значения преобразуются к временной зоне сервера Loginom.
  * **Дублировать единичные значения** — при установке данного флага для каждого дочернего элемента XML ответа сервиса дублируется информация содержащаяся в родительском элементе (например, атрибуты, дочерние элементы с maxOccurs=1). В противном случае эта информация выводится только для первого дочернего элемента.
  * **Проверять на строгое соответствие XSD** — при установке флага производится валидация XML ответа сервиса на строгое соответствие XSD схеме, заявленной в WSDL веб-сервиса. В противном случае проверка ответа веб-сервиса производится в упрощенном, ускоренном режиме и большинство проверок осуществляются только для элементов XML, которые были выбраны для вывода в результирующем наборе данных.
  * **Генерировать составные метки полей** — метка поля вывода элементов XML ответа сервиса содержит полный путь их расположения в иерархической структуре XML.
* Дополнительно.
  * **Выдавать описание кодов завершения** — отображать описание ошибок, произошедших при отправке запроса, получении и разборе ответа сервиса.
  * **Выдавать "сырой" ответ сервера** — в выходном наборе данных порта *Дополнительные данные* выводить SOAP-сообщение ответа сервиса.
* Отладка.
  * **Сохранять текст запроса на диск** — все запросы, отправленные сервису записываются в указанную папку в файловом хранилище.
  * **Имитировать запрос с ответом в файле** — при установке флага фактического запроса к веб-сервису не происходит. Обработчику в качестве заглушки вместо ответа веб-сервиса подставляется указанный файл.