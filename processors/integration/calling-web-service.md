# ![](../../images/icons/vendors/wsdlclient.svg) Вызов веб-сервиса

Компонент позволяет взаимодействовать с внешним [SOAP-сервисом](https://ru.wikipedia.org/wiki/SOAP), отправляя ему запросы и получая ответы. SOAP-сервису может быть отправлено несколько последовательных запросов, формируемых из строк входной таблицы с параметрами запросов. На выходных портах обработчика формируются таблицы с ответами сервиса, возвращенными ошибками и дополнительными данными. XML ответов сервиса преобразуются в табличное представление.

Для работы с веб-сервисом необходимо настроенное [подключение к веб-сервису](../../integration/connections/list/web-service.md).

## Порты

### Входные порты

* ![](../../images/icons/ports/input_connection_inactive.svg) — Подключение к веб-сервису (связь с компонентом подключение к веб-сервису).
* ![](../../images/icons/ports/output_table_inactive.svg) — Источник данных запроса (таблица с параметрами запроса).
* ![](../../images/icons/ports/optional_input_variable_inactive.svg) — Управляющие переменные (переменные), необязательный.

### Выходные порты

* ![](../../images/icons/ports/output_table_inactive.svg) — Выходной набор данных (таблица с ответом веб-сервиса).
* ![](../../images/icons/ports/output_table_inactive.svg) — Исключения (WSDL fault).
* ![](../../images/icons/ports/output_table_inactive.svg) — Дополнительные данные (таблица).

## Настройка

Мастер настройки вызова сервиса состоит из нескольких шагов.

### Выбор метода запроса

Необходимо выбрать один из доступных методов запроса, предоставляемых веб-сервисом. В верхней части окна расположено поле *Подключение* отображающее состояние подключения:

* Если подключение не активно, то запись *Подключение к веб-сервису* окрашена серым, и справа от поля становится активна кнопка *Подключить*, после подключения к сервису кнопка становится серой и меняет надпись на *Подключено*.
* Если к порту *Подключение к веб-сервису* не установлена связь с подключением *Веб-сервис*, то поле *Подключение* будет неактивно и иметь запись *Локальное*, а кнопка значение *Не подключено*. В данном случае дальнейшая настройка узла невозможна.

В нижней части окна расположена таблица, она становится активной после подключения к сервису. Таблица состоит из трех столбцов:

* Первый столбец не имеет названия. В нем расположены радиокнопки для выбора используемого метода;
* **Объект** — отображает дерево запросов полученное от подключения к веб-сервису;
* **Описание** — описание метода полученное от подключения к веб-сервису.

### Настройка запроса

На данном шаге задаются параметры запроса. Слева расположен список значений параметров, который берется из полей входного набора данных. Справа расположена таблица где представлен выбранный метод с отображением его иерархической структуры. Для дальнейшей настройки необходимо проставить связи между полями и параметрами сделать это можно несколькими способами:

* **Методом Drag-and-drop** — перетащить метку поля на элемент метода;
* В правой таблице выбрать нужный элемент метода, и в столбце *Связанные поля* нажав на ячейку столбца выбрать из выпадающего списка метку поля из входного набора;
* Нажать на ![](../../images/icons/toolbar-controls_18x18/toolbar-controls_18x18_auto-connect_default.svg) *Связать все автоматически*, в таком случае происходит автоматическая связка метки с элементом метода. Связка происходит на соотношении меток и типов данных полей входного набора и метода.

> **Примечание**: Если связь между полем и объектом была установлена неправильно, ее можно удалить, нужно выбрать метку и нажать на кнопку ![](../../media/app/icons/toolbar-18/toolbar-delete-join.svg) на линии связи. При необходимости удаления всех связей используется кнопка ![](../../images/icons/toolbar-controls_18x18/toolbar-controls_18x18_remove-all-links_default.svg) *Удалить все связи*.

* **Наличие временной зоны** — указание для данных формата дата/время временной зоны машины, на которой производится экспорт.
  * Не указывать.
  * Не указывать для даты — не указывать временную зону для элементов типа Date.
  * Указывать всегда.

### Настройка ответа сервиса

Ответ веб-сервиса на этом шаге представлен в виде дерева возвращаемых параметров. Необходимо отметить галочками те параметры, которые будут включены в результирующую таблицу в виде отдельных столбцов.

### Настройка обрабатываемых исключений

Информация о возвращаемых ошибках выводится в отдельную таблицу. Галочками отмечаются параметры ошибок, которые будут включены в неё.

### Дополнительные параметры

* Идентификация запроса.
  * **Один запрос в каждой строке входного запроса** — каждая строка таблицы представляет один полноценный запрос.
  * **Идентификатор запроса — поле входного набора** — запрос формируется из нескольких строк таблицы. Из выпадающего списка необходимо выбрать поле, которое послужит идентификатором последовательности строк. Это поле должно иметь одинаковые значения в тех строках, которые необходимо включить в один запрос.
* Обработка ответа.
  * **Временная зона по умолчанию** — влияет на обработку значений типа дата/время, полученных от веб-сервиса. Если у пришедшего значения отсутствует временная зона, то считается, что она равна временной зоне, которая указана по умолчанию. Если присутствует, то значение преобразуется к указанной временной зоне.
  * **Дублировать единичные значения** — при установленном флаге в группах наряду с узлами, которые могут многократно повторяться, включают также узлы, которые могут присутствовать только в единичном экземпляре (например, атрибуты, дочерние элементы с maxOccurs=1). Значение последних будет дублироваться в каждой строке, т.е. для каждого повторения многократного узла. Если опция отключена, единичные значения будут указываться только в первой строке.
  * **Проверять на строгое соответствие XSD** — при *снятии* данного флага проверка ответа веб-сервиса производится в упрощенном режиме. Фактически проверяются: 1) атрибуция узлов (англ. термин — Particle attribution), 2) правильность типов данных. Большинство проверок осуществляются только для тех узлов, которые были выбраны для импорта. Все эти особенности обеспечивают высокую скорость упрощенного режима. При *установке* флага валидация осуществляется по всем правилам XSD для всего документа независимо от того, требуется ли импортировать его целиком или только какие-то отдельные части.
  * **Генерировать составные метки полей** — если параметр ответа находится в дереве со сложной структурой, то при установленном флаге будут генерироваться метки полей, содержащие полный путь расположения параметра в дереве.
* Дополнительно.
  * **Выдавать описание кодов завершения** — отображать или не отображать описание ошибок, произошедших при формировании и отправке запроса, получении и разборе ответа веб-сервиса.
  * **Выдавать "сырой" ответ сервера** —  когда данный флаг установлен, в виде строкового поля наряду с разобранным ответом сервера будет доступен также и неразобранный ответ.
* Отладка.
  * **Сохранять текст запроса на диск** — все запросы, отправленные сервису записываются в указанную папку в файловом хранилище.
  * **Имитировать запрос с ответом в файле** — при установке флага фактического запроса к веб-сервису не происходит. Обработчику в качестве заглушки вместо ответа веб-сервиса подставляется указанный файл.

### Настройка соответствия между столбцами

Для каждого из трех выходных портов происходит *Настройка соответствия между столбцами*. На этом этапе можно изменить имена и метки полей в выходных наборах данных, а так же удалить не нужные столбцы.

### Описание узла

* **Метка** — содержит задаваемое пользователем имя вызова веб-сервиса;
* **Комментарий** — в этой форме можно оставить любую справочную информацию о веб-сервисе.