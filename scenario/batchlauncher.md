# Пакетное выполнение сценариев

Возможны следующие варианты исполнения сценариев:

* **интерактивный режим** — выполнение узлов сценария в интерфейсе клиента Loginom. Этот режим предназначен для разработки и отладки сценариев, просмотра отчетов;
* **пакетный режим** — исполнение сценариев пакета без отображения какого-либо пользовательского интерфейса и вывода сообщений на экран. Обычно результатом выполнения пакета при этом является формирование итоговых данных и передача их в стороннюю систему (например, в хранилище данных или другую учетную систему).

Пакетное выполнение сценариев осуществляется при помощи утилиты BatchLauncher, поставляемой в комплекте с сервером Loginom версий Team, Standard, Enterprise. При установке по умолчанию утилита располагается по пути:

`"C:\Program Files\BaseGroup\Loginom 6\Server\BatchLauncher.exe"`.

Для запуска пакетного выполнения по расписанию можно использовать сторонний планировщик заданий, например, планировщик заданий Windows.

Синтаксис строки запуска в пакетном режиме:

```cmd
BatchLauncher /Package=<FileName> [/Teach] [/Node=<NodeName>] [/Address=<Address>] [/Port=<Port>] [/UserName=<UserName> [/Password=<Password>]] [/PortName.VarName=<Value>]
```

Где:

**/Package**, **/Teach**, **/Node**, **/Address**, **/Port**, **/UserName**, **/Password**, **/PortName.VarName** — параметры запуска в пакетном режиме.

Несколько параметров в строке запуска разделяются символом пробела.

Пример:

```cmd
 "C:\Program Files\BaseGroup\Loginom 6\Server\BatchLauncher.exe" /Package=test.lgp /Teach
 ```

## Описание параметров

### Package

Путь к файлу пакета внутри [файлового хранилища](..\location_user_files.md). Обязательный параметр.

Примеры:

```cmd
BatchLauncher /Package=/user/test.lgp
BatchLauncher "/Package=/user/test and log.lgp"
```

### Node

Имя узла, который необходимо выполнить. При этом выполняются указанный узел и все предшествующие ему узлы — то есть все узлы, которые необходимо выполнить для формирования его входных данных. Узел не должен находиться в подмодели. Если параметр не указан, то выполняются все узлы пакета, для которых заданы необходимые [настройки режима пакетной обработки](./setting-batch-processing-mode.md).

**Примечание:** Имя узла задается при настройке [модификатора доступа](./access-modifier.md).

Примеры:

```cmd
BatchLauncher /Package=/user/test.lgp "/Node=Экспорт в SQL"
BatchLauncher /Package=/user/test.lgp /Node=Экспорт_в_txt
```

### PortName.VarName

Используется для задания значений входных переменных узла, определенного параметром /Node.

**PortName** — наименование порта, **VarName** — наименование переменной, значение которой необходимо задать в строке запуска.

Примеры:

```cmd
BatchLauncher /Package=/user/test.lgp /Node=test_node /Port1.Parameter1=true
/Port1.Parameter2=2008-01-02T22:24:24 "/Port2.Parameter1=Hello World!" /Port2.Parameter2=null /Port2.Parameter3=3.14 /Port2.Parameter4=4.025E4
```

Можно не указывать наименование порта (например /Parameter1=true), однако, если переменная с указанным таким образом именем присутствует в нескольких портах, то возникнет исключение. Ошибка так же возникнет, если указано имя несуществующей переменной.

Исходное строковое значение, указанное в командной строке, конвертируется к типу данных целевой переменной:

* Если исходное строковое значение равно null (с учётом регистра), то целевая переменная получает пустое значение независимо от её типа данных.
* Если целевая переменная имеет тип Логический, Целый, Вещественный или Дата/Время, то исходное строковое значение конвертируется по правилам соответствующего типа, причём для Вещественного типа используется десятичный разделитель . (точка). Для Даты/Времени используется подмножество форматов ISO 8601: "YYYY-MM-DD", "YYYY-MM-DDThh:mm[:ss[.zzz]]", "hh:mm[:ss[.zzz]]". Допустимыми значениями Логического типа считаются true и false (без учёта регистра).
* Если целевая переменная имеет Строковый тип, то преобразование типа данных не выполняется. Если исходное значение заключено в одинарные кавычки, то эти кавычки разэкранируются, в противном случае исходное значение присваивается в переменную без изменений.
* Если целевая переменная имеет Переменный тип, то происходит попытка поочерёдно преобразовать исходное строковое значение к типам Логический, Целый, Вещественный и Дата/Время, причём если ни одно из этих преобразований не удалось, то целевая переменная получает строковое значение.
* Для переменных типа Вещественный и Переменный в качестве параметров можно передавать экспоненциальную форму записи числа (пример: 4.205E2, 4.205E-2)

Пример:

```cmd
BatchLauncher /Package=/user/test.lgp /Node=test_node /Var0=null /Var1=True /Var2=1 /Var3='1' /Var4='null' /Var5= /Var6=test /Var7='te''st' /Var8="test" "/Var9=a b c"

Если все переменные имеют Переменный тип, то они получат следующие значения:

Var0 - пустое значение
Var1 - Логическое значение true
Var2 - Целое значение 1
Var3 - Строковое значение 1
Var4 - Строковое значение null
Var5 - пустая строка
Var6 - Строковое значение test
Var7 - Строковое значение te'st
Var8 - Строковое значение "test"
Var9 - Строковое значение a b c
```

### Teach

Запуск пакета в [режиме «Обучение»](app/glossary/training_processors#автоматическое_обучение). Если параметр не указан, то пакет запускается в режиме «Выполнение».

Пример:

```cmd
BatchLauncher /Package=/user/test.lgp /Teach
```

### Address

IP адрес или имя хоста сервера Loginom. По умолчанию используется localhost.

Пример:

```cmd
BatchLauncher /Package=/user/test.lgp /Address=192.168.0.95
```

### Port

Порт, по которому происходит обращение к серверу Loginom. По умолчанию используется **4386**.

Пример:

```cmd
BatchLauncher /Package=/user/test.lgp /Address=192.168.0.95 /Port=4555
```

### UserName

Имя пользователя. Если параметр не указан, то используется пользователь по умолчанию.

Пример:

`BatchLauncher /Package=/user/test.lgp /UserName=user`

### Password

Пароль пользователя. Если параметр не указан, то используется пустой пароль.

Пример:

```cmd
BatchLauncher /Package=/user/test.lgp /UserName=user /Password=12345
```

-----

**Примечание:**

При использовании русскоязычных символов в имени пакета или пути к пакету требуется предварительное выполнение команды `chcp 1251`.

Пример:

```cmd
chcp 1251
"C:\Program Files\BaseGroup\Loginom 6\Server\BatchLauncher.exe" /Package=/user/Обучение_квантования/Квантование.lgp /Teach
```

При использовании пробельных символов в выражении, задающем значение параметра, все выражение необходимо заключить в двойные кавычки.

Пример:

```cmd
chcp 1251
"C:\Program Files\BaseGroup\Loginom 6\Server\BatchLauncher.exe" "/Package=/user/Обучение квантования/Квантование.lgp" /Teach
```

Если один и тот же параметр указан в строке запуска несколько раз, то используется последнее указанное значение.

-----