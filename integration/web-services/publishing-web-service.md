# Создание и публикация веб-сервиса

Публикация и работа созданных в Loginom веб-сервисов доступна при наличии установленного компонента [Loginom Integrator](https://loginom.ru/platform/pricing#component-integrator).

## Реализация методов сервиса

Взаимодействие с веб-сервисом осуществляется при помощи его методов. Каждый метод веб-сервиса имеет определенный идентификатор и выполняет сопоставленное этому идентификатору действие. Как правило (но не обязательно) 
метод принимает входные данные и возвращает ответ. Действие, выполняемое методом, в Loginom реализуется публикуемым узлом сценария, а структура входных данных и ответа определяется входными и выходными портами этого узла. В качестве идентификатора метода используется строка, состоящая из имени узла и имени пакета, в котором узел содержится.

Чаще всего в качестве такого узла выступает *[Подмодель](../../processors/control/submodel.md)*, поскольку в ней пользователь имеет возможность реализовать произвольную логику и задать структуру входных и выходных данных, создавая и настраивая ее порты. Но в общем случае таким узлом может быть любой узел сценария, имеющий настройки, описанные в разделе "Настройка публикуемых узлов". В случае, если таких узлов в пакете несколько и публикуется несколько пакетов, то для каждого из таких узлов создается соответствующий ему метод сервиса.

## Настройка публикуемых узлов

Публикуемый в качестве метода веб-сервиса узел должен иметь следующие настройки:

* задан [модификатор доступа](../../scenario/access-modifier.md) `Опубликованный`;
* в окне выбора [модификатора доступа](../../scenario/access-modifier.md) задано уникальное в пределах пакета имя узла;
* узел должен быть видимым из корня сценария, т.е. в случае, если узел является вложенным (в подмодель или иерархию подмоделей), то у всех подмоделей, в которых он содержится, должен быть установлен [модификатор доступа](../../scenario/access-modifier.md) `Открытый`;
* во входных и выходных портах заданы поля/переменные, определяющие структуру запроса и ответа метода веб-сервиса.

> **Важно:** При использовании [автосинхронизации полей](../../scenario/ports/field-synchronization.md) возможны ситуации когда поля/переменные в портах определены механизмом автосинхронизации из структуры данных, подаваемых в порт. Если при включенной автосинхронизации удалить связь порта с источником данных, то ранее созданные из данных поля/переменные будут удалены из порта механизмом автосинхронизации как временные, актуальные только для конкретных данных. При публикации такого узла поля/переменные в портах не будут заданы, соответственно структуры запроса/ответа сервиса не будут определены.
>
> В связи с этим порты публикуемых узлов необходимо настроить одним из способов:
> * отключить [автосинхронизацию полей](../../scenario/ports/field-synchronization.md) и при необходимости задать нужные поля/переменные (рекомендуется).
> * если механизмом автосинхронизации уже созданы необходимые поля/переменные из подаваемых в порт данных, то необходимо отредактировать любой из [параметров](../../processors/transformation/fields-parameters.md) (*имя*, *метку*, *назначение* и т.д.) всех необходимых полей/переменных. Измененные поля выделяются в мастере настройки порта жирным шрифтом и фиксируются как постоянные, ожидаемые портом.
> * очистить список и создать все необходимые поля/переменные вручную.

[Параметр](../../processors/transformation/fields-parameters.md) *Назначение* входного поля влияет на свойство его обязательности в запросе к сервису. Поля с *Назначением* `Не задано` или `Непригодное` публикуются как необязательные (в WSDL SOAP-сервиса имеют атрибут `minOccurs="0"`, а в схеме запроса REST-сервиса не входят в состав *required*-узлов). Поля с другими значениями параметра являются обязательными в запросе. В ответе сервиса все поля публикуются как обязательные.

## Публикация

После того, как необходимые для публикации узлы сценария настроены, необходимо произвести публикацию пакета.

> **Примечание:** Для минимизации возможных проблем подключения к веб-сервису сторонними клиентами рекомендуется использовать в имени публикуемого пакета только символы английского алфавита, числа и символ подчеркивания.

Чтобы опубликовать пакет, в [дереве навигации](../../interface/main-menu.md#navigatsiya) необходимо кликнуть на нужном пакете правой кнопкой мыши и в контекстном меню выбрать пункт «Публикация пакетов…». Откроется окно публикации пакетов со следующими настройками:

* **Опубликованные пакеты** — список уже опубликованных пакетов.
* **Путь к файлу пакета** — указывается вручную или выбирается из выпадающего списка открытых пакетов.
* **Выбрать пространство имен**:
  * *использовать пространство имен Loginom Integrator*;
  * *генерировать уникальное для пакета*;
  * *генерировать уникальное для каждой версии пакета*;
  * *задать вручную*.

### Обновление публикации

В случае изменения настройек входных/выходных портов (например, количество или имена полей/переменных) опубликованного ранее узла, необходимо обновить публикацию пакета, в котором этот узел содержиться. Для этого нужно:

1. сохранить пакет с измененным узлом;
2. выбрать этот пакет в окне настроек «Публикация пакетов…» и нажать кнопку *Обновить*.

> **Важно:** После обновления следует проверить работоспособность вызовающих переопубликованный веб-сервис узлов сценария и, при необходимости, перенастроить их.

## Обращение к созданному сервису

К созданному веб-сервису можно обращаться по двум стандартам:

**SOAP** — протокол обмена структурированными сообщениями. Общение по данному протоколу осуществляется при помощи языка описания веб-сервисов WSDL, который основан на языке XML. Информацию о WSDL веб-сервиса можно получить по ссылке:

`http://<Server>/lgi/service.svc?wsdl`

**REST** — способ взаимодействия клиентских приложений и сервисов, который использует стандарты: HTTP, URL, JSON и XML. Информацию о формировании REST-запросов и ответов можно получить по ссылке:

`http://<Server>/lgi/service.svc/rest/help`

## Совместимость веб-сервисов Loginom с Deductor

В продуктах прошлого поколения ([Deductor](https://basegroup.ru/deductor/description)) публикация веб-сервисов осуществлялась DIS ([Deductor Integration Server](https://basegroup.ru/deductor/components/integration-server)), а обращение к веб-сервисам DIS из сценариев Deductor осуществлялось при помощи узла *WEB-сервис*. Чтобы использовать этот узел для обращения к веб-сервисам Loginom, при публикации пакетов должна применятся настройка *использовать пространство имен Loginom Integrator*.

> **Примечание:** Применение настройки *использовать пространство имен Loginom Integrator* при публикации нескольких пакетов накладывает ограничение на именование публикуемых узлов. Имена, задаваемые при выборе [модификатора доступа](../../scenario/access-modifier.md), должны быть уникальны в рамках всего набора публикуемых пакетов.

Веб-сервисы Loginom имеют следующую особенность: XML ответов и запросов веб-сервисов в своей структуре могут иметь элемент `<PortName>` (элемент содержит имя порта), отсутствующий в веб-сервисах DIS. Для устранения этого различия в публикуемых подмоделях Loginom в имени порта должно указываться *<Не задано>*.

> **Примечание:** Опция *<Не задано>* при именовании порта доступна в случае, если этот порт единственный входной или выходной. В этом случае для формирования произвольной структуры запроса/ответа в качестве портов подмодели удобно использовать порты типа "Дерево данных" с возможностью задать структуру данных XSD-схемой, т.е. использовать тот же механизм, что и в Deductor Integration Server.